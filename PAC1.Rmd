---
title: "PAC1"
author: "Xènia Castellà"
date: "2025-03-30"
output: 
  pdf_document:
    keep_tex: true
    toc: true
  html_document:
    toc: true
github: "https://github.com/xcasteca/Castella-Camps-Xenia-PEC1"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_libraries, include=FALSE}
require(SummarizedExperiment)
require(BiocManager)
```

```{r asignaciones, include=FALSE}
myfile <- "human_cachexia.csv"
```

# Resum

# Objectius

# Mètdoes

# Resultats

# Discussió

# Conclusions

## Punt 2

Llegim el fitxer que conté les dades.
```{r}
dades <- read.csv(myfile, header = TRUE, sep = ",", stringsAsFactors = FALSE, check.names = FALSE)
head(dades)
str(dades)
dim(dades)
```

En el nostre cas és un fitxer de dades de metabolòmica que tracta la caquexia amb 77 pacients i 65 variables. Observem que tenim dues columnes, `Patient ID` i `Muscle loss`, que són les nostres covariables que ens donen informació de les mostres. La resta de les columnes ens serveixen per construir una matriu de dades, ja que són els matebolits. 

```{r}
row_dades <- DataFrame(
  Patient_ID = dades$`Patient ID`,
  Muscle_loss = dades$`Muscle loss`
)

assay_dades <- as.matrix(dades[, -c(1,2)])
rownames(assay_dades) <- dades$`Patient ID`

col_dades <- DataFrame(
  Sample = colnames(dades[,-c(1,2)])
)
                       
se <- SummarizedExperiment(assays=list(counts=assay_dades),
                           colData = col_dades,
                           rowData = row_dades)
```

Com que la classe `SummarizedExperiment` és una extensió d' `ExpressionSet`, és molt similar. No obstant, la principal diferència és que `SummarizedExperiment` és més flexible amb la informació de les files, per exemple, permet tant `GRanges based` com els `DataFrames`.

Un cop creat l'objecte de la classe `SummarizedExperiment`, continuem fent una anàlisi exploratòria. Primer de tot, observem quin aspecte té el nostre objecte.

## Anàlisi estadístic univariant

```{r}
se
head(assay(se))
dim(assay(se))
colData(se)
dim(colData(se))
head(rowData(se))
dim(rowData(se))
```
Ara, utilitzem eines estadístiques bàsiques i ho representem gràficament. 

```{r}
round(apply(assay(se), 2, summary))
```

Per cada metabolit grafiquem un histograma. 

```{r}
opt <- par(mfrow = c(3,3))
for (i in 1:ncol(assay(se)))
  hist(assay(se)[,i], main = colnames(assay(se))[i], xlab = colnames(assay(se))[i])
par(opt)
```
També ho representem amb boxplot per veure totes les mostres juntes.
```{r}
boxplot(assay(se), col = "blue", main = "Valors d'expressió per a \n 63 mostres dos grups", xlab="Matebolits", 
        ylab="Expressió", las=2, cex.axis=0.7, cex.main=0.7, outline = FALSE)
```
Acabem de veure que si ho grafiquem amb boxplot no podem comparar els metabolits, ja que tenen valors molt diferents. Per tant, normalitzem les dades fent ús de logaritmes.

```{r}
boxplot(log2(assay(se)), col = "blue", main = "Valors d'expressió per a \n 63 mostres dos grups", xlab="Matebolits", 
        ylab="Expressió", las=2, cex.axis=0.7, cex.main=0.7, outline = FALSE)
```
Així que veiem que és millor que d'ara endavant prenem logaritmes. 

## Visualització de dades multivariants

Calcular les components principals per mostres ens ajudarà per detectar mostres inusuals o efectes `batch`. Així que primer de tot, calculem les components principals (`PCA`).

```{r}
pcX <- prcomp(t(log2(assay(se))), scale = TRUE)
loads <- round(pcX$sdev^2/sum(pcX$sdev^2)*100,1)
```

```{r}
xlab <- c(paste("PC1", loads[1], "%"))
ylab <- c(paste("PC2", loads[2], "%"))
plot(pcX$x[,1:2], xlab=xlab, ylab = ylab, col = "blue", main = "PCA")
names2plot <- paste0(substr(names(assay(se)), 1,3),1:4)
text(pcX$x[,1], pcX$x[,2],names2plot, pos = 3, cex = .6)
```


```{r}
colnames(assay(se)) <- names2plot
clust.euclid.average <- hclust(dist(t(assay(se))), method = "average")
plot(clust.euclid.average, hang = -1)
```


# Referències

Podeu trobar el codi a [GitHub](`r "https://github.com/xcasteca/Castella-Camps-Xenia-PEC1"`)
